# 💰 راهنمای ایجاد خودکار کیف پول

## 🎯 **ویژگی جدید: ایجاد خودکار کیف پول**

حالا سیستم به صورت خودکار برای هر کاربری که کیف پول ندارد، یک کیف پول جدید ایجاد می‌کند.

## 🔧 **نحوه کارکرد:**

### **1. بررسی خودکار:**
- هر بار که `getUserWallet()` فراخوانی می‌شود
- سیستم ابتدا بررسی می‌کند کیف پول وجود دارد یا نه
- اگر وجود نداشت، خودکار ایجاد می‌کند

### **2. متدهای موجود:**

```dart
// دریافت کیف پول (ایجاد خودکار در صورت عدم وجود)
Wallet? wallet = await WalletService().getUserWallet();

// ایجاد صریح کیف پول
Wallet? wallet = await WalletService().createUserWallet();
```

## 🧪 **تست سیستم:**

### **تست 1: کاربر جدید**
1. **کاربر جدید وارد می‌شود**
2. **به صفحه شارژ کیف پول می‌رود**
3. **سیستم خودکار کیف پول ایجاد می‌کند**
4. **لاگ موفق نمایش داده می‌شود**

### **تست 2: کاربر موجود**
1. **کاربر موجود وارد می‌شود**
2. **کیف پول موجود پیدا می‌شود**
3. **هیچ کیف پول جدیدی ایجاد نمی‌شود**

## 📱 **لاگ‌های مورد انتظار:**

### **کاربر جدید:**
```
I/flutter: دریافت کیف پول برای کاربر: 0618fd07-14f0-49f8-9570-b008f0ec8f1f
I/flutter: کیف پول وجود ندارد، در حال ایجاد کیف پول جدید...
I/flutter: شروع ایجاد کیف پول جدید برای کاربر: 0618fd07-14f0-49f8-9570-b008f0ec8f1f
I/flutter: ✅ کیف پول جدید با موفقیت ایجاد شد برای کاربر: 0618fd07-14f0-49f8-9570-b008f0ec8f1f
I/flutter: کیف پول ID: 12345678-1234-1234-1234-123456789012
```

### **کاربر موجود:**
```
I/flutter: دریافت کیف پول برای کاربر: 0618fd07-14f0-49f8-9570-b008f0ec8f1f
I/flutter: کیف پول موجود پیدا شد
```

## 🚀 **مراحل تست:**

### **1. تست اولیه:**
1. **وارد اپلیکیشن شوید**
2. **به داشبورد بروید**
3. **روی "شارژ کیف پول" کلیک کنید**
4. **لاگ‌ها را بررسی کنید**

### **2. تست کامل:**
1. **شارژ کیف پول کنید**
2. **مبلغ را وارد کنید**
3. **پرداخت را انجام دهید**
4. **بررسی کنید کیف پول ایجاد شد**

## ✅ **نتیجه موفق:**

- ✅ کیف پول خودکار ایجاد شد
- ✅ لاگ‌ها پاک هستند
- ✅ سیستم کار می‌کند
- ✅ شارژ کیف پول موفق است

## 🆘 **در صورت مشکل:**

### **اگر کیف پول ایجاد نشد:**
1. **RLS را بررسی کنید**
2. **لاگ‌ها را بررسی کنید**
3. **SQL را دوباره اجرا کنید**

### **اگر خطای RLS داشت:**
```sql
-- اجرای فوری:
ALTER TABLE wallets DISABLE ROW LEVEL SECURITY;
ALTER TABLE wallets ENABLE ROW LEVEL SECURITY;
CREATE POLICY "wallets_policy" ON wallets FOR ALL USING (true) WITH CHECK (true);
```

---

**🎉 حالا سیستم ایجاد خودکار کیف پول آماده است!**
