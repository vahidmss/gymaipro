# ุฑุงูููุง ุชุณุช ููุชูฺฉุดูโูุง Background

## ๐ฏ ูุฏู
ุชุณุช ฺฉุฑุฏู ุงุฑุณุงู ููุชูฺฉุดู ูพุงู ููุช ุงูพ ฺฏุฑูุฏู ุจุณุชู ุงุณุช.

## ๐ฑ ูุฑุงุญู ุชุณุช

### 1. ุขูุงุฏูโุณุงุฒ
- **ุฏู ุฏุณุชฺฏุงู ุง ุฏู ุงฺฉุงูุช** ุฏุงุดุชู ุจุงุดุฏ
- **ูุฑ ุฏู ุฏุณุชฺฏุงู** ุจุงุฏ ุงูพ ุฑุง ูุตุจ ฺฉุฑุฏู ุจุงุดูุฏ
- **ูุฑ ุฏู ุฏุณุชฺฏุงู** ุจุงุฏ ูุงฺฏู ฺฉุฑุฏู ุจุงุดูุฏ

### 2. ุจุฑุฑุณ ุชูุธูุงุช
1. **ุจู ุชูุธูุงุช ุจุฑูุฏ** โ "ุชุณุช ููุชูฺฉุดู Background"
2. **"ุจุฑุฑุณ Device Tokens"** ุฑุง ุจุฒูุฏ
3. ูุทูุฆู ุดูุฏ ฺฉู device tokens ุซุจุช ุดุฏูโุงูุฏ
4. **"ุจุฑุฑุณ ุญุถูุฑ"** ุฑุง ุจุฒูุฏ ุชุง ุจุจูุฏ ุขุง ุฏุฑ ฺุช ูุนุงู ูุณุชุฏ ุง ูู

### 3. ุชุณุช ุงุฑุณุงู ูพุงู
1. **ID ฺฉุงุฑุจุฑ ฺฏุฑูุฏู** ุฑุง ูุงุฑุฏ ฺฉูุฏ
2. **ูพุงู ุชุณุช** ุจููุณุฏ
3. **"ุงุฑุณุงู ูพุงู ุชุณุช"** ุฑุง ุจุฒูุฏ
4. **ุงูพ ุฑุง ฺฉุงููุงู ุจุจูุฏุฏ** (ูู minimize)
5. **ููุชุธุฑ ููุชูฺฉุดู ุจุงุดุฏ**

## ๐ ุจุฑุฑุณโูุง ููู

### Device Tokens
- ุจุงุฏ `is_push_enabled: true` ุจุงุดุฏ
- ุจุงุฏ `platform` ุฏุฑุณุช ุจุงุดุฏ (android/ios)
- ุจุงุฏ `last_seen` ุจูโุฑูุฒ ุจุงุดุฏ

### Chat Presence
- ุงฺฏุฑ ุฏุฑ ฺุช ูุนุงู ุจุงุดุฏุ ููุชูฺฉุดู ุงุฑุณุงู ููโุดูุฏ
- ุจุงุฏ `is_active: false` ุจุงุดุฏ ุง ุงุตูุงู ุญุถูุฑ ูุฏุงุดุชู ุจุงุดุฏ

### Firebase Setup
- ูพุฑูฺู Firebase ุจุงุฏ ูุนุงู ุจุงุดุฏ
- Service Account Key ุจุงุฏ ุฏุฑ Supabase ุชูุธู ุดุฏู ุจุงุดุฏ
- FCM ุจุงุฏ ุฏุฑุณุช ฺฉุงุฑ ฺฉูุฏ

## ๐จ ูุดฺฉูุงุช ุฑุงุฌ

### 1. ููุชูฺฉุดู ููโุขุฏ
**ุจุฑุฑุณ ฺฉูุฏ:**
- ุขุง device tokens ุซุจุช ุดุฏูโุงูุฏุ
- ุขุง ฺฉุงุฑุจุฑ ุฏุฑ ฺุช ูุนุงู ุงุณุชุ
- ุขุง Firebase ุฏุฑุณุช ุชูุธู ุดุฏูุ
- ุขุง internet connection ุฏุงุฑุฏุ

### 2. ููุชูฺฉุดู ููุท ููุช ุงูพ ุจุงุฒ ุงุณุช ูโุขุฏ
**ูุดฺฉู:** Background notification ุฏุฑุณุช ฺฉุงุฑ ููโฺฉูุฏ
**ุฑุงู ุญู:** ุจุฑุฑุณ Firebase Console ู Edge Function logs

### 3. ููุชูฺฉุดู ููโุขุฏ ุญุช ููุช ุงูพ ุจุณุชู ุงุณุช
**ุจุฑุฑุณ ฺฉูุฏ:**
- ุขุง Edge Function ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏุ
- ุขุง FCM tokens ูุนุชุจุฑ ูุณุชูุฏุ
- ุขุง notification permissions ุฏุงุฏู ุดุฏูุ

## ๐ Log ูุง ููู

### Flutter Logs
```
=== CHAT SERVICE: Sending notification via Edge Function ===
=== CHAT SERVICE: Chat notification sent successfully ===
```

### Supabase Logs
```
Chat notification sent to X devices for user Y
FCM V1 token sent successfully
```

### Firebase Console
- Messages tab ุฑุง ุจุฑุฑุณ ฺฉูุฏ
- Delivery reports ุฑุง ฺฺฉ ฺฉูุฏ

## ๐๏ธ Debug Steps

### 1. ุจุฑุฑุณ Edge Function
```bash
# ุฏุฑ Supabase Dashboard
Functions โ send-chat-notification โ Logs
```

### 2. ุจุฑุฑุณ Database
```sql
-- ุจุฑุฑุณ device tokens
SELECT * FROM device_tokens WHERE user_id = 'USER_ID';

-- ุจุฑุฑุณ chat presence
SELECT * FROM chat_presence WHERE user_id = 'USER_ID';
```

### 3. ุจุฑุฑุณ Firebase Console
- Project Settings โ Service Accounts
- Cloud Messaging โ Reports

## โ ููููุช
ุงฺฏุฑ ููุชูฺฉุดู ููุช ุงูพ ุจุณุชู ุงุณุช ูโุขุฏุ ุณุณุชู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ!

## ๐ง ุชูุธูุงุช ุงุถุงู

### Android
- `android/app/src/main/AndroidManifest.xml` ุจุงุฏ ุฏุฑุณุช ุจุงุดุฏ
- `google-services.json` ุจุงุฏ ุฏุฑุณุช ุจุงุดุฏ

### iOS
- `ios/Runner/Info.plist` ุจุงุฏ ุฏุฑุณุช ุจุงุดุฏ
- `GoogleService-Info.plist` ุจุงุฏ ุฏุฑุณุช ุจุงุดุฏ

## ๐ ูพุดุชุจุงู
ุงฺฏุฑ ูุดฺฉู ุฏุงุดุชุฏุ log ูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ ู ูุดฺฉู ุฑุง ฺฏุฒุงุฑุด ุฏูุฏ.
