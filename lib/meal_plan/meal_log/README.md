# Meal Log Module

ماژول ثبت تغذیه روزانه (Meal Log) برای مدیریت و ثبت وعده‌های غذایی، مکمل‌ها و داروهای مصرفی کاربر در هر روز طراحی شده است.

---

## ساختار پوشه‌ها

```
lib/meal_plan/meal_log/
├── dialogs/      # دیالوگ‌های مربوط به meal log (افزودن، ویرایش، جایگزین و ...)
├── models/       # مدل‌های داده‌ای (غذا، وعده، مکمل و ...)
├── screens/      # صفحه اصلی meal log
├── services/     # سرویس‌های business logic و ارتباط با دیتابیس
├── utils/        # توابع کمکی (محاسبات، فرمت‌بندی و ...)
├── widgets/      # ویجت‌های UI (کارت‌ها، نمودارها، سوییچ‌ها و ...)
└── README.md     # این فایل
```

---

## اجزای اصلی

### Dialogs
- `add_food_dialog.dart` - دیالوگ افزودن غذا به وعده
- `edit_food_dialog.dart` - ویرایش مقدار غذا
- `add_supplement_dialog.dart` - افزودن مکمل/دارو
- `substitute_food_dialog.dart` - انتخاب جایگزین برای غذا
- `persian_food_log_date_picker_dialog.dart` - انتخاب تاریخ شمسی

### Models
- `food_log.dart` - مدل اصلی ثبت تغذیه روزانه
- `food_meal_log.dart` - مدل وعده غذایی
- `food_log_item.dart` - مدل آیتم غذا
- `logged_supplement.dart` - مدل مکمل/داروی ثبت شده

### Screens
- `meal_log_screen.dart` - صفحه اصلی ثبت و مشاهده تغذیه روزانه

### Services
- `meal_log_service.dart` - سرویس اصلی عملیات meal log (ثبت، ویرایش، حذف و ...)

### Utils
- `meal_log_utils.dart` - توابع کمکی (محاسبات تغذیه‌ای، فرمت تاریخ و ...)

### Widgets
- `meal_log_app_bar.dart` - AppBar سفارشی برای meal log
- `food_item_card.dart` - کارت نمایش آیتم غذا
- `supplement_card.dart` - کارت مکمل/دارو
- `meal_section.dart` - بخش هر وعده غذایی
- `meal_section_card.dart` - کارت بخش وعده غذایی با جزئیات
- `nutrition_chart.dart` - نمودار تغذیه‌ای روزانه
- `nutrition_chart_toggle.dart` - سوییچ نمایش نمودار
- `mode_selector.dart` - انتخاب حالت نمایش
- `meal_type_card.dart` - کارت نوع وعده
- `add_item_menu.dart` - منوی افزودن آیتم جدید
- `meal_type_selector_overlay.dart` - انتخاب نوع وعده
- `session_selector.dart` - انتخاب جلسه/روز
- `empty_state_guide.dart` - راهنمای حالت خالی
- `meal_log_widgets.dart` - export همه ویجت‌ها

---

## منطق و معماری جدید (2024)

### ذخیره‌سازی و سینک خودکار
- **هر تغییر (افزودن/ویرایش/حذف غذا یا مکمل)** فقط در حافظه محلی (SharedPreferences) ذخیره می‌شود (بدون نیاز به دکمه سیو).
- **با هر ورود به اپ**، همه لاگ‌های ذخیره‌شده لوکال (امروز و روزهای قبل) به دیتابیس سینک و پاک می‌شوند.
- **با هر تغییر روز (در تقویم یا ...)**، قبل از بارگذاری روز جدید، لاگ لوکال روز قبلی به دیتابیس سینک و پاک می‌شود.
- **هیچ دکمه سیو یا سینک دستی وجود ندارد**؛ همه چیز خودکار و بی‌وقفه انجام می‌شود.

### انتخاب پیش‌فرض برنامه و سشن
- آخرین برنامه و سشن انتخاب‌شده برای هر روز، به صورت محلی ذخیره می‌شود و هنگام بازگشت به آن روز به صورت پیش‌فرض نمایش داده می‌شود (قابل تغییر توسط کاربر).

### ساختار ماژولار
- تمام منطق بیزینسی (سرویس‌ها)، مدل‌ها، ویجت‌ها و دیالوگ‌ها کاملاً جدا و قابل استفاده مجدد هستند.
- هیچ کد تکراری یا وابستگی غیرضروری بین بخش‌ها وجود ندارد.
- UI فقط وظیفه نمایش و تعامل را دارد و منطق ذخیره‌سازی و سینک در سرویس‌ها پیاده‌سازی شده است.

---

## نحوه استفاده (به‌روز شده)

### استفاده از صفحه اصلی
```dart
import 'package:your_app/meal_plan/meal_log/screens/meal_log_screen.dart';

Navigator.push(
  context,
  MaterialPageRoute(builder: (context) => const FoodLogScreen()),
);
```

### نکات توسعه
- برای افزودن قابلیت جدید، فقط کافیست فایل مربوطه را در پوشه مناسب قرار دهید و از سرویس‌ها و مدل‌های موجود استفاده کنید.
- برای هر نوع ذخیره‌سازی یا سینک جدید، منطق را فقط در سرویس‌ها اضافه کنید و UI را ساده نگه دارید.
- هیچ دکمه سیو/سینک دستی اضافه نکنید؛ همه چیز باید خودکار باشد.

---

## ویژگی‌های کلیدی
- ذخیره‌سازی سریع و آفلاین (local-first)
- سینک خودکار با دیتابیس
- انتخاب پیش‌فرض برنامه و سشن برای هر روز
- ساختار کاملاً ماژولار و قابل نگهداری
- حذف کامل کدهای اضافی و تکراری
- تجربه کاربری حرفه‌ای و بی‌دردسر

---

## نکات مهم
- هر بخش (dialogs, models, widgets, ...) کاملاً جدا و مستقل است.
- هیچ کدی بین meal_log و meal_plan_builder به اشتراک گذاشته نمی‌شود.
- برای توسعه یا افزودن قابلیت جدید، فقط کافیست فایل مربوطه را در پوشه مناسب قرار دهید.
- هیچ دکمه سیو یا سینک دستی در UI وجود ندارد؛ همه چیز خودکار است. 