# داشبورد مربی (Trainer Dashboard)

## 📋 **توضیحات کلی**

ماژول داشبورد مربی برای مدیریت شاگردان و روابط مربی-شاگرد طراحی شده است. این ماژول فقط برای کاربران با نقش `trainer` قابل دسترسی است.

## 🏗️ **ساختار فایل‌ها**

```
lib/trainer_dashboard/
├── screens/
│   └── client_management/
│       └── client_management_screen.dart
├── services/
│   ├── trainer_client_service.dart
│   └── user_search_service.dart
├── widgets/
│   ├── athlete_search_widget.dart
│   └── relationship_stats_widget.dart
├── models/
│   └── trainer_client.dart
└── README.md
```

## 🎯 **قابلیت‌ها**

### **مدیریت شاگردان**
- ✅ مشاهده لیست شاگردان
- ✅ افزودن شاگرد جدید
- ✅ حذف شاگرد
- ✅ نمایش آمار روابط

### **جستجوی ورزشکاران**
- ✅ جستجو بر اساس username
- ✅ نمایش اطلاعات ورزشکار
- ✅ بررسی وجود رابطه قبلی

### **آمار و گزارش‌گیری**
- ✅ تعداد شاگردان فعال
- ✅ تعداد شاگردان غیرفعال
- ✅ تعداد شاگردان مسدود

## 🔧 **سرویس‌ها**

### **TrainerClientService**
مدیریت روابط مربی-شاگرد:
- `createTrainerClientRelationship()` - ایجاد رابطه جدید
- `getTrainerClients()` - دریافت لیست شاگردان
- `updateRelationshipStatus()` - به‌روزرسانی وضعیت
- `endRelationship()` - پایان رابطه
- `getRelationshipStats()` - دریافت آمار

### **UserSearchService**
جستجو و مدیریت کاربران:
- `searchAthletes()` - جستجوی ورزشکاران
- `getUserProfile()` - دریافت پروفایل کاربر
- `hasRelationship()` - بررسی وجود رابطه
- `hasPendingRequest()` - بررسی وجود درخواست

## 🎨 **ویجت‌ها**

### **AthleteSearchWidget**
ویجت جستجوی ورزشکاران با قابلیت‌های:
- جستجوی real-time
- نمایش نتایج با کارت‌های زیبا
- انتخاب ورزشکار

### **RelationshipStatsWidget**
نمایش آمار روابط با:
- کارت‌های رنگی برای هر وضعیت
- آیکون‌های مناسب
- نمایش تعداد

## 📱 **صفحات**

### **ClientManagementScreen**
صفحه اصلی مدیریت شاگردان شامل:
- **تب شاگردان**: نمایش لیست شاگردان فعلی
- **تب افزودن شاگرد**: جستجو و افزودن شاگرد جدید
- **آمار**: نمایش آمار روابط

## 🔐 **امنیت**

- فقط کاربران با نقش `trainer` می‌توانند به این ماژول دسترسی داشته باشند
- تمام عملیات با RLS (Row Level Security) محافظت می‌شوند
- بررسی مجوزها قبل از هر عملیات

## 🚀 **استفاده**

```dart
// انتقال به صفحه داشبورد مربی
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => const ClientManagementScreen(),
  ),
);
```

## 🔄 **آینده**

### **قابلیت‌های پیشنهادی:**
- [ ] صفحه آمار تفصیلی هر شاگرد
- [ ] سیستم پیام‌رسانی داخلی
- [ ] مدیریت برنامه‌های تمرینی
- [ ] سیستم امتیازدهی و نظرات
- [ ] گزارش‌گیری پیشرفته

### **بهینه‌سازی‌ها:**
- [ ] کش کردن داده‌ها
- [ ] لودینگ lazy
- [ ] فیلترهای پیشرفته
- [ ] جستجوی پیشرفته

## 📝 **نکات مهم**

1. **بررسی نقش کاربر**: قبل از نمایش این ماژول، حتماً نقش کاربر را بررسی کنید
2. **مدیریت خطاها**: تمام عملیات async با try-catch محافظت شده‌اند
3. **UI Responsive**: تمام ویجت‌ها responsive طراحی شده‌اند
4. **Performance**: از `mounted` check برای جلوگیری از memory leak استفاده شده

## 🐛 **عیب‌یابی**

### **خطاهای رایج:**
- **"relation does not exist"**: جدول‌های مربوطه در دیتابیس ایجاد نشده
- **"permission denied"**: RLS policies درست تنظیم نشده
- **"user not found"**: کاربر در جدول profiles وجود ندارد

### **راه‌حل‌ها:**
1. اجرای migration های دیتابیس
2. بررسی RLS policies
3. اطمینان از وجود کاربر در جدول profiles 