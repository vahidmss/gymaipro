# راهنمای رفع مشکل بخش مربی‌های من

## 🎯 مشکل
بخش "مربی‌های من" در باشگاه من باید مربی‌های واقعی را از دیتابیس Supabase دریافت و نمایش دهد.

## ✅ راه‌حل پیاده‌سازی شده

### 1. بررسی ساختار دیتابیس
- جدول `profiles`: اطلاعات کاربران و مربی‌ها
- جدول `trainer_clients`: روابط مربی-شاگرد
- سرویس `TrainerClientService`: مدیریت روابط مربی-شاگرد

### 2. فایل‌های SQL ایجاد شده
- `sql/create_profiles_table.sql`: ایجاد جدول profiles
- `sql/create_trainer_clients_table.sql`: ایجاد جدول trainer_clients

### 3. بهبودهای انجام شده

#### در `lib/my_club/screens/my_trainers_screen.dart`:
- اضافه کردن debug logs برای بررسی عملکرد
- بهبود error handling
- اضافه کردن اطلاعات بیشتر در console

#### در `lib/trainer_dashboard/services/trainer_client_service.dart`:
- اضافه کردن debug logs
- بهبود query برای دریافت اطلاعات مربی
- اضافه کردن `avatar_url` به query

## 🔧 نحوه استفاده

### 1. اجرای SQL ها
ابتدا فایل‌های SQL زیر را در Supabase اجرا کنید:
```sql
-- اجرای فایل create_profiles_table.sql
-- اجرای فایل create_trainer_clients_table.sql
-- اجرای فایل fix_specializations_column.sql (برای رفع مشکل ستون)
```

### 2. تست عملکرد
1. وارد بخش "باشگاه من" شوید
2. روی "مربی‌های من" کلیک کنید
3. console logs را بررسی کنید
4. اگر مربی‌ای وجود دارد، باید نمایش داده شود

### 3. ایجاد رابطه مربی-شاگرد
برای تست، می‌توانید رابطه مربی-شاگرد ایجاد کنید:
```sql
INSERT INTO trainer_clients (trainer_id, client_id, status) 
VALUES ('trainer_uuid', 'client_uuid', 'active');
```

## 📊 ساختار داده‌ها

### جدول profiles
- `id`: شناسه کاربر
- `username`: نام کاربری
- `first_name`: نام
- `last_name`: نام خانوادگی
- `role`: نقش (athlete/trainer/admin)
- `specialization`: تخصص مربی
- `rating`: امتیاز مربی
- `avatar_url`: آواتار

### جدول trainer_clients
- `id`: شناسه رابطه
- `trainer_id`: شناسه مربی
- `client_id`: شناسه شاگرد
- `status`: وضعیت (pending/active/rejected/ended)
- `created_at`: تاریخ ایجاد

## 🐛 عیب‌یابی

### خطای "column specialization does not exist":
این خطا به دلیل تفاوت نام ستون در دیتابیس است. برای رفع:
1. فایل `sql/fix_specializations_column.sql` را در Supabase اجرا کنید
2. یا دستی ستون `specializations` را به جدول `profiles` اضافه کنید

### خطای "type 'List<dynamic>' is not a subtype of type 'String'":
این خطا به دلیل اینکه `specializations` یک لیست است، نه رشته. برای رفع:
1. تابع `_formatSpecializations` اضافه شده که لیست را به رشته تبدیل می‌کند
2. اگر لیست باشد، با کاما جدا می‌شود
3. اگر رشته باشد، همان رشته نمایش داده می‌شود

### اگر مربی‌ها نمایش داده نمی‌شوند:
1. console logs را بررسی کنید
2. اطمینان حاصل کنید که جداول در دیتابیس وجود دارند
3. بررسی کنید که RLS policies درست تنظیم شده‌اند
4. اطمینان حاصل کنید که کاربر احراز هویت شده است

### اگر خطای دیتابیس دریافت می‌کنید:
1. بررسی کنید که جداول `profiles` و `trainer_clients` وجود دارند
2. بررسی کنید که foreign key constraints درست تنظیم شده‌اند
3. بررسی کنید که RLS policies درست تنظیم شده‌اند
4. بررسی کنید که ستون `specializations` در جدول `profiles` وجود دارد

## 🚀 ویژگی‌های پیاده‌سازی شده

### نمایش مربی‌ها
- ✅ لیست مربی‌های فعال
- ✅ اطلاعات مربی (نام، تخصص، امتیاز)
- ✅ آواتار مربی
- ✅ وضعیت رابطه
- ✅ تاریخ عضویت

### عملیات مربی‌ها
- ✅ چت با مربی
- ✅ مشاهده پروفایل مربی
- ✅ پایان رابطه با مربی

### UI/UX
- ✅ طراحی ریسپانسیو
- ✅ حالت خالی (هنگامی که مربی‌ای وجود ندارد)
- ✅ انیمیشن‌های نرم
- ✅ پیام‌های خطا مناسب

## 📱 تست نهایی

1. **تست بدون مربی**: باید پیام "هنوز مربی‌ای ندارید" نمایش داده شود
2. **تست با مربی**: باید لیست مربی‌ها با اطلاعات کامل نمایش داده شود
3. **تست عملیات**: چت، پروفایل، و پایان رابطه باید کار کنند

## 🔮 بهبودهای آینده

- اضافه کردن جستجوی مربی‌ها
- اضافه کردن فیلتر بر اساس تخصص
- اضافه کردن امتیازدهی به مربی‌ها
- اضافه کردن نوتیفیکیشن‌ها
